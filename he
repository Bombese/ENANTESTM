local Players = game:GetService("Players")
local player = Players.LocalPlayer
getgenv().AutoFarmEnabled = false
getgenv().FarmHeight = 10
getgenv().WarpDelay = 0.3
getgenv().MaxFarmDistance = 1000

local lastWarpTime = 0
local FarmableMonsters = {
    "Goblin", "Zombie", "Desert Scorpion", "Sand Warrior", "Forest Bear",
    "Jungle Monkey", "Cave Bat", "Giant Spider", "Orc", "High Orc", "Snow Yeti"
}

-- // logic หาตัวละคร //
local function getClosestMonster()
    local character = player.Character
    local hrp = character and character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    local closest, shortestDist = nil, getgenv().MaxFarmDistance
    
    for _, obj in ipairs(workspace:GetChildren()) do
        local humanoid = obj:FindFirstChildOfClass("Humanoid")
        if obj:IsA("Model") and humanoid and humanoid.Health > 0 then
            local isTarget = false
            for _, name in ipairs(FarmableMonsters) do
                if obj.Name:lower():find(name:lower()) then
                    isTarget = true
                    break
                end
            end
            
            if isTarget then
                local targetHRP = obj.PrimaryPart or obj:FindFirstChild("HumanoidRootPart")
                if targetHRP then
                    local dist = (hrp.Position - targetHRP.Position).Magnitude
                    if dist < shortestDist then
                        shortestDist = dist
                        closest = targetHRP
                    end
                end
            end
        end
    end
    return closest
end

-- // Main Loop //
task.spawn(function()
    while task.wait(0.1) do
        if getgenv().AutoFarmEnabled then
            local character = player.Character
            local hrp = character and character:FindFirstChild("HumanoidRootPart")
            
            if hrp and (tick() - lastWarpTime >= getgenv().WarpDelay) then
                local target = getClosestMonster()
                if target then
                    hrp.CFrame = CFrame.new(target.Position + Vector3.new(0, getgenv().FarmHeight, 0))
                    lastWarpTime = tick()
                end
            end
        end
    end
end)

Main:Toggle({
    Title = "Auto Farm (Warp)",
    Desc = "วาร์ปไปหามอนสเตอร์อัตโนมัติ",
    Value = false,
    Callback = function(state)
        getgenv().AutoFarmEnabled = state
    end
})

Main:Slider({
    Title = "Warp Delay",
    Desc = "ระยะเวลาดีเลย์ (ค่าน้อย = เร็ว)",
    Min = 0.1,
    Max = 2,
    Step = 0.1,
    Value = 0.3,
    Callback = function(v)
        getgenv().WarpDelay = v
    end
})

MainTab:Slider({
    Title = "Farm Height",
    Desc = "ความสูงเหนือหัวมอนสเตอร์",
    Min = 5,
    Max = 30,
    Step = 1,
    Value = 10,
    Callback = function(v)
        getgenv().FarmHeight = v
    end
})