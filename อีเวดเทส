-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "ENAN อีเวด",
    Icon = "user",
    Author = "Beta 10",
    OpenButton = {
        Title = "ENAN HUB",
        Icon = "monitor",
        Enabled = true,
        Draggable = true,
    }
})
local HackTab = Window:Tab({
    Title = "Hack",
    Icon = "zap",
})

local p = game.Players.LocalPlayer
local RunService = game:GetService("RunService")

local speed = 35
local tpwalkConn -- เก็บ connection ไว้เปิด/ปิด

HackTab:Toggle({
    Title = "Hack Speed",
    Desc = "วิ่งไวแบบเนียน",
    Value = false,
    Callback = function(v)
        if v then
            -- เปิด
            tpwalkConn = RunService.RenderStepped:Connect(function(dt)
                local c = p.Character
                if not c then return end

                local hrp = c:FindFirstChild("HumanoidRootPart")
                local hum = c:FindFirstChild("Humanoid")
                if not hrp or not hum then return end

                if hum.MoveDirection.Magnitude > 0 then
                    hrp.CFrame += hum.MoveDirection * speed * dt
                end
            end)
        else
            -- ปิด
            if tpwalkConn then
                tpwalkConn:Disconnect()
                tpwalkConn = nil
            end
        end
    end
})
HackTab:Select()

-- Noclip Toggle
HackTab:Toggle({
    Title = "Noclip",
    Desc = "เดินทะลุกำแพง",
    Value = false,
    Callback = function(v)
        getgenv().Noclip = v
    end
})
-- ===== SEMI INVISIBLE MODE =====

getgenv().SemiInvisible = false

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local function SetSemiInvisible(state)
    local char = player.Character
    if not char then return end

    for _,v in pairs(char:GetDescendants()) do
        -- ส่วนร่างกาย
        if v:IsA("BasePart") then
            if v.Name ~= "HumanoidRootPart" then
                v.Transparency = state and 0.75 or 0
                v.CanCollide = not state
            end
        end

        -- หน้าตัวละคร
        if v:IsA("Decal") then
            v.Transparency = state and 0.9 or 0
        end

        -- ชื่อบนหัว
        if v:IsA("BillboardGui") then
            v.Enabled = not state
        end
    end
end

-- กันตายแล้วโหมดหาย
player.CharacterAdded:Connect(function()
    task.wait(1)
    if getgenv().SemiInvisible then
        SetSemiInvisible(true)
    end
end)

-- ===== UI : ADD TO HACK TAB =====
HackTab:Toggle({
    Title = "Semi Invisible",
    Desc = "โปร่งใส (คนอื่นเห็นยาก)",
    Value = false,
    Callback = function(v)
        getgenv().SemiInvisible = v
        SetSemiInvisible(v)
    end
})
-- ===== SKELETON ESP (R6 + R15) =====

getgenv().SkeletonESP = false

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Skeletons = {}

-- ===== Bones =====

local BonesR15 = {
    {"Head","UpperTorso"},
    {"UpperTorso","LowerTorso"},

    {"UpperTorso","LeftUpperArm"},
    {"LeftUpperArm","LeftLowerArm"},
    {"LeftLowerArm","LeftHand"},

    {"UpperTorso","RightUpperArm"},
    {"RightUpperArm","RightLowerArm"},
    {"RightLowerArm","RightHand"},

    {"LowerTorso","LeftUpperLeg"},
    {"LeftUpperLeg","LeftLowerLeg"},
    {"LeftLowerLeg","LeftFoot"},

    {"LowerTorso","RightUpperLeg"},
    {"RightUpperLeg","RightLowerLeg"},
    {"RightLowerLeg","RightFoot"},
}

local BonesR6 = {
    {"Head","Torso"},

    {"Torso","Left Arm"},
    {"Torso","Right Arm"},

    {"Torso","Left Leg"},
    {"Torso","Right Leg"},
}

-- ===== Functions =====

local function ClearSkeleton(plr)
    if Skeletons[plr] then
        for _,line in pairs(Skeletons[plr]) do
            line:Remove()
        end
        Skeletons[plr] = nil
    end
end

local function CreateSkeleton(plr, bones)
    Skeletons[plr] = {}

    for _ = 1,#bones do
        local line = Drawing.new("Line")
        line.Thickness = 1.5
        line.Color = Color3.fromRGB(0,255,170)
        line.Transparency = 1
        line.Visible = false
        table.insert(Skeletons[plr], line)
    end
end

-- ===== Render =====

RunService.RenderStepped:Connect(function()
    if not getgenv().SkeletonESP then
        for _,plr in pairs(Players:GetPlayers()) do
            ClearSkeleton(plr)
        end
        return
    end

    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            local char = plr.Character
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if not humanoid then continue end

            local bones = humanoid.RigType == Enum.HumanoidRigType.R15 and BonesR15 or BonesR6

            if not Skeletons[plr] then
                CreateSkeleton(plr, bones)
            end

            for i,bone in ipairs(bones) do
                local p1 = char:FindFirstChild(bone[1])
                local p2 = char:FindFirstChild(bone[2])
                local line = Skeletons[plr][i]

                if p1 and p2 then
                    local s1,v1 = Camera:WorldToViewportPoint(p1.Position)
                    local s2,v2 = Camera:WorldToViewportPoint(p2.Position)

                    if v1 and v2 then
                        line.From = Vector2.new(s1.X,s1.Y)
                        line.To   = Vector2.new(s2.X,s2.Y)
                        line.Visible = true
                    else
                        line.Visible = false
                    end
                else
                    line.Visible = false
                end
            end
        end
    end
end)

-- ===== UI =====
HackTab:Toggle({
    Title = "Skeleton ESP (R6 / R15)",
    Desc = "รองรับผู้เล่นทุก Rig",
    Value = false,
    Callback = function(v)
        getgenv().SkeletonESP = v
    end
})
local FlyConnection
local ReframeThread
local bp, bv, bg

HackTab:Toggle({
    Title = "Fly Bypass",
    Desc = "Anti-Ban Fly",
    Default = false,
    Callback = function(state)
        local Players = game:GetService("Players")
        local RunService = game:GetService("RunService")
        local UIS = game:GetService("UserInputService")
        local plr = Players.LocalPlayer
        local char = plr.Character or plr.CharacterAdded:Wait()
        local hum = char:WaitForChild("Humanoid")
        local hrp = char:WaitForChild("HumanoidRootPart")
        local cam = workspace.CurrentCamera

        if state then
            getgenv().Fly = true
            local MOVE_SPEED = 40
            local Y_POWER = 0.8
            local DEADZONE = 0.25
            local MAX_Y_STEP = 1
            local SMOOTH = 0.1

            local gameSettings = UserSettings():GetService("UserGameSettings")
            local oldControl = gameSettings.ControlMode
            local oldMouse = UIS.MouseBehavior

            local hoverY = hrp.Position.Y
            local smoothY = hoverY

            local highlight = Instance.new("Highlight")
            highlight.Adornee = char
            highlight.FillTransparency = 1
            highlight.OutlineTransparency = 0.2
            highlight.OutlineColor = Color3.fromRGB(120,200,255)
            highlight.Parent = char

            local function startFly()
                if bp then bp:Destroy() end
                if bv then bv:Destroy() end
                if bg then bg:Destroy() end

                hum.PlatformStand = true

                bp = Instance.new("BodyPosition", hrp)
                bp.MaxForce = Vector3.new(0,1e9,0)
                bp.P = 80000
                bp.D = 3000
                bp.Position = hrp.Position

                bv = Instance.new("BodyVelocity", hrp)
                bv.MaxForce = Vector3.new(1e9,0,1e9)

                bg = Instance.new("BodyGyro", hrp)
                bg.MaxTorque = Vector3.new(1e9,1e9,1e9)
                bg.P = 40000
                bg.D = 1200
                bg.CFrame = cam.CFrame
            end

            startFly()

            ReframeThread = task.spawn(function()
                while getgenv().Fly do
                    if not (hrp:FindFirstChild("BodyPosition") and hrp:FindFirstChild("BodyVelocity") and hrp:FindFirstChild("BodyGyro")) then
                        startFly()
                    end
                    task.wait(0.5)
                end
            end)

            FlyConnection = RunService.RenderStepped:Connect(function()
                if not getgenv().Fly then return end

                gameSettings.ControlMode = Enum.ControlMode.MouseLockSwitch
                UIS.MouseBehavior = Enum.MouseBehavior.LockCenter

                for _,v in ipairs(char:GetDescendants()) do
                    if v:IsA("BasePart") then
                        v.CanCollide = false
                    end
                end

                local dir = hum.MoveDirection
                bv.Velocity = Vector3.new(dir.X * MOVE_SPEED, 0, dir.Z * MOVE_SPEED)

                if dir.Magnitude > 0.01 then
                    local lookY = cam.CFrame.LookVector.Y
                    if math.abs(lookY) > DEADZONE then
                        hoverY += math.clamp(lookY * Y_POWER, -MAX_Y_STEP, MAX_Y_STEP)
                    end
                end

                smoothY += (hoverY - smoothY) * SMOOTH
                bp.Position = Vector3.new(hrp.Position.X, smoothY, hrp.Position.Z)
                bg.CFrame = cam.CFrame
            end)

        else
            -- ปิด Fly แบบสมบูรณ์
            getgenv().Fly = false
            if FlyConnection then FlyConnection:Disconnect() end
            if ReframeThread then task.cancel(ReframeThread) end

            -- ลบ BodyPosition / BodyVelocity / BodyGyro
            if bp then bp:Destroy() end
            if bv then bv:Destroy() end
            if bg then bg:Destroy() end

            -- รีเซ็ตตัวละคร
            for _,v in ipairs(char:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.CanCollide = true
                end
                if v:IsA("Highlight") then
                    v:Destroy()
                end
            end

            if hum then hum.PlatformStand = false end
        end
    end
})
-- =========================
-- SERVICES
-- =========================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer

-- =========================
-- CONFIG
-- =========================
local REVIVE_RANGE = 15
local REVIVE_CHECK_DELAY = 0.3
local AFK_TELEPORT_DELAY = 1.5
local AFK_HEIGHT = 1200

-- =========================
-- VARIABLES
-- =========================
local autoReviveEnabled = false
local afkMoneyEnabled = false

local reviveLoop = nil
local afkLoop = nil
local afkPart = nil

local interactEvent =
    ReplicatedStorage
        :WaitForChild("Events")
        :WaitForChild("Character")
        :WaitForChild("Interact")

-- =========================
-- UTILS
-- =========================
local function isDowned(plr)
    local char = plr.Character
    if not char then return false end
    return char:GetAttribute("Downed") == true
end

-- =========================
-- AFK PART
-- =========================
local function createAFKPart()
    if afkPart then return end

    afkPart = Instance.new("Part")
    afkPart.Name = "AFK_PART"
    afkPart.Size = Vector3.new(25, 2, 25)
    afkPart.Anchored = true
    afkPart.CanCollide = true
    afkPart.Material = Enum.Material.Neon
    afkPart.Color = Color3.fromRGB(0, 170, 255)
    afkPart.Position = Vector3.new(0, AFK_HEIGHT, 0)
    afkPart.Parent = workspace
end

local function tpToAFKPart(hrp)
    if afkPart and hrp then
        hrp.CFrame = afkPart.CFrame + Vector3.new(0, 3, 0)
    end
end

-- =========================
-- AUTO REVIVE
-- =========================
local function startAutoRevive()
    if reviveLoop then return end

    reviveLoop = task.spawn(function()
        while autoReviveEnabled do
            local char = LocalPlayer.Character
            local hrp = char and char:FindFirstChild("HumanoidRootPart")

            if hrp then
                for _, pl in ipairs(Players:GetPlayers()) do
                    if pl ~= LocalPlayer and isDowned(pl) then
                        local pChar = pl.Character
                        local pHrp = pChar and pChar:FindFirstChild("HumanoidRootPart")

                        if pHrp then
                            local dist = (hrp.Position - pHrp.Position).Magnitude
                            if dist <= REVIVE_RANGE then
                                pcall(function()
                                    interactEvent:FireServer("Revive", true, pl.Name)
                                end)
                            end
                        end
                    end
                end
            end

            task.wait(REVIVE_CHECK_DELAY)
        end
        reviveLoop = nil
    end)
end

local function stopAutoRevive()
    autoReviveEnabled = false
end

-- =========================
-- AFK MONEY SYSTEM
-- =========================
local function startAFKMoney()
    if afkLoop then return end

    createAFKPart()

    afkLoop = task.spawn(function()
        while afkMoneyEnabled do
            local char = LocalPlayer.Character
            local hrp = char and char:FindFirstChild("HumanoidRootPart")

            if not hrp then
                task.wait(0.5)
                continue
            end

            local found = false

            for _, pl in ipairs(Players:GetPlayers()) do
                if pl ~= LocalPlayer and isDowned(pl) then
                    local pChar = pl.Character
                    local pHrp = pChar and pChar:FindFirstChild("HumanoidRootPart")

                    if pHrp then
                        found = true
                        repeat
                            hrp.CFrame = pHrp.CFrame + Vector3.new(0, 3, 0)
                            pcall(function()
                                interactEvent:FireServer("Revive", true, pl.Name)
                            end)
                            task.wait(0.4)
                        until not isDowned(pl) or not afkMoneyEnabled
                    end
                end
            end

            if not found then
                tpToAFKPart(hrp)
            end

            task.wait(AFK_TELEPORT_DELAY)
        end

        afkLoop = nil
    end)
end

local function stopAFKMoney()
    afkMoneyEnabled = false
    if afkPart then
        afkPart:Destroy()
        afkPart = nil
    end
end

-- =========================
-- RESPAWN FIX (สำคัญ)
-- =========================
LocalPlayer.CharacterAdded:Connect(function(char)
    if not afkMoneyEnabled then return end

    task.spawn(function()
        local hrp = char:WaitForChild("HumanoidRootPart", 10)
        local hum = char:WaitForChild("Humanoid", 10)
        if not hrp or not hum then return end

        -- กันเกมดึงกลับ
        for i = 1, 5 do
            if afkPart then
                hrp.CFrame = afkPart.CFrame + Vector3.new(0, 3, 0)
            end
            task.wait(0.3)
        end

        hum.StateChanged:Connect(function(_, new)
            if afkMoneyEnabled and afkPart then
                if new == Enum.HumanoidStateType.Running
                or new == Enum.HumanoidStateType.RunningNoPhysics then
                    task.wait(0.1)
                    hrp.CFrame = afkPart.CFrame + Vector3.new(0, 3, 0)
                end
            end
        end)
    end)
end)

-- =========================
-- UI TOGGLES (HackTab ONLY)
-- =========================
HackTab:Toggle({
    Title = "ออโต้ชุบเพื่อน",
    Desc = "ชุบผู้เล่นที่ล้มอัตโนมัติเมื่ออยู่ใกล้",
    Callback = function(state)
        autoReviveEnabled = state
        if state then
            startAutoRevive()
        else
            stopAutoRevive()
        end
    end
})

HackTab:Toggle({
    Title = "AFK Money (New)",
    Desc = "เสก Part + วาร์ปชุบอัตโนมัติ",
    Callback = function(state)
        afkMoneyEnabled = state
        if state then
            startAFKMoney()
        else
            stopAFKMoney()
        end
    end
})
local AdditionalsTab = Window:Tab({
    Title = "Additionals",
    Icon = "plus"
})
local player = game.Players.LocalPlayer

-- =============================
-- STATUS
-- =============================
local extraStatus = {
    Korblox = false,
    Headless = false,
}

-- =============================
-- APPLY BODY MOD
-- =============================
local function applyBodyMod()
    getgenv().Setting = {
        ["Body"] = {
            ["Korblox"] = extraStatus.Korblox,
            ["Headless"] = extraStatus.Headless,
        },
    }

    loadstring(game:HttpGet(
        "https://raw.githubusercontent.com/khen791/script-khen/refs/heads/main/KorbloxAndHeadless.txt",
        true
    ))()
end

-- รันซ้ำตอนเกิดใหม่
player.CharacterAdded:Connect(function()
    task.wait(1)
    applyBodyMod()
end)

-- =============================
-- KORBLOX
-- =============================
AdditionalsTab:Toggle({
    Title = "ขากุด (Korblox)",
    Desc = "เปิด/ปิด ขากุด โดยใช้สคริปต์จากลิงก์",
    Value = false,
    Callback = function(state)
        extraStatus.Korblox = state
        applyBodyMod()
    end
})

-- =============================
-- HEADLESS
-- =============================
AdditionalsTab:Toggle({
    Title = "หัวล่องหน (Headless)",
    Desc = "เปิด/ปิด หัวล่องหน โดยใช้สคริปต์จากลิงก์",
    Value = false,
    Callback = function(state)
        extraStatus.Headless = state
        applyBodyMod()
    end
})

-- =========================
-- REMOVE DARK / FULL BRIGHT
-- =========================
AdditionalsTab:Button({
    Title = "ลบความมืดออก",
    Desc = "ทำให้ Map สว่าง และตัดเงาออกทั้งหมด",
    Callback = function()
        local Lighting = game:GetService("Lighting")

        Lighting.Ambient = Color3.new(1,1,1)
        Lighting.OutdoorAmbient = Color3.new(1,1,1)
        Lighting.Brightness = 3
        Lighting.ExposureCompensation = 1
        Lighting.GlobalShadows = false

        for _, v in pairs(Lighting:GetChildren()) do
            if v:IsA("ColorCorrectionEffect")
            or v:IsA("DepthOfFieldEffect")
            or v:IsA("BloomEffect")
            or v:IsA("SunRaysEffect")
            or v:IsA("Atmosphere")
            or v:IsA("Sky") then
                v:Destroy()
            end
        end
    end
})

-- =============================
-- FAKE EDASH
-- =============================
local fakeEdashRunning = false
local fakeEdashThread

AdditionalsTab:Button({
    Title = "เสกท่าเวล100 ของปลอม ❌",
    Desc = "เปิด / ปิด Fake Edash (ของคนอื่น)",
    Callback = function()
        if not fakeEdashRunning then
            fakeEdashRunning = true
            print("Fake Edash เริ่มทำงาน")

            task.spawn(function()
                local success, err = pcall(function()
                    loadstring(game:HttpGet(
                        "https://raw.githubusercontent.com/G4V3S/S/refs/heads/main/fake%20edash.lua"
                    ))()
                end)

                if not success then
                    warn("Fake Edash Error:", err)
                end
            end)
        else
            fakeEdashRunning = false
            print("Fake Edash ถูกปิดแล้ว (ต้องรีเซ็ตเกมเพื่อหยุดทั้งหมด)")
        end
    end
})