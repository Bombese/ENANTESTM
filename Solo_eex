-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "Solo Hunters Felon HUB (Premium)",
    Icon = "user",
    Author = "https://discord.gg/AXTKtmUvyf",
    OpenButton = {
        Title = "Felon HUB",
        Icon = "monitor",
        Enabled = true,
        Draggable = true,
    }
})

local Main = Window:Tab({
    Title = "Main",
    Icon = "home", -- เปลี่ยน Icon เป็นชื่อที่ Library รองรับ
})

local VirtualUser = game:GetService("VirtualUser")
_G.AutoClick = false -- ตั้งต้นให้เป็น false ไว้ก่อน

-- ฟังก์ชันสำหรับคลิก
local function DoClick()
    task.spawn(function()
        while _G.AutoClick do
            pcall(function()
                VirtualUser:CaptureController()
                VirtualUser:ClickButton1(Vector2.new(0, 0))
            end)
            task.wait(0.1) -- ความเร็วในการกด
        end
    end)
end

Main:Toggle({
    Title = "Auto Attack",
    Desc = "Auto hit (Sword)",
    Value = false,
    Callback = function(v)
        _G.AutoClick = v -- กำหนดค่าตามปุ่ม Toggle (true หรือ false)
        if v then
            DoClick() -- ถ้าเปิด ให้เริ่มทำงาน
            print("Auto Clicker: ON")
        else
            print("Auto Clicker: OFF")
        end
    end
})
Main:Button({
    Title = "Auto Quest",
    Desc = "Auto Task",
    Callback = function()
        local questName = "Subway" -- เปลี่ยนชื่อเควสตรงนี้จุดเดียวพอ

        local rs = game:GetService("ReplicatedStorage")
        local questRF = rs:WaitForChild("RemoteServices")
            :WaitForChild("QuestsV2Service")
            :WaitForChild("RF")
            :WaitForChild("RequestQuest")

        -- กันกดรัว
        if _G.RequestingQuest then return end
        _G.RequestingQuest = true

        -- ยิงแบบกันพัง
        local success, result = pcall(function()
            return questRF:InvokeServer(questName)
        end)

        if success then
            print("รับเควสสำเร็จ:", result)
        else
            warn("รับเควสไม่สำเร็จ:", result)
        end

        task.wait(1)
        _G.RequestingQuest = false
    end
})
--// ===== SETUP ครั้งเดียวพอ =====
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local RemoteServices = ReplicatedStorage:WaitForChild("RemoteServices")
local DungeonService = RemoteServices:WaitForChild("DungeonService")
local RF = DungeonService:WaitForChild("RF")
local StartDungeon = RF:WaitForChild("StartDungeon") -- RemoteFunction


-- ฟังก์ชันเริ่มดันเจี้ยน
local function startDungeon()
    local success, result = pcall(function()
        return StartDungeon:InvokeServer()
    end)

    if success then
        print("Dungeon Started:", result)
    else
        warn("Dungeon Error:", result)
    end
end


--// ===== UI BUTTON =====
Main:Button({
    Title = "Start Dungeon",
    Desc = "Start the dungeon once",
    Callback = function()
        startDungeon()
    end
})
-- [1] Services & Global Variables
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer

getgenv().AutoFarmEnabled = false
getgenv().FarmHeight = 5
getgenv().WarpDelay = 0.3
getgenv().MaxDistance = 1000

-- รายชื่อมอนสเตอร์ (แก้ไขเพิ่ม/ลดได้ที่นี่)
local FarmableMonsters = {
    "Goblin", "Zombie", "Desert Scorpion", "Sand Warrior", "Forest Bear",
    "Jungle Monkey", "Cave Bat", "Giant Spider", "Orc", "High Orc", "Snow Yeti"
}

-- [2] Functions (ต้องอยู่ด้านบนของ Loop เสมอ)
local function getClosestMonster()
    local character = player.Character
    local hrp = character and character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    local closest, shortestDist = nil, getgenv().MaxDistance
    
    for _, obj in ipairs(workspace:GetChildren()) do
        local humanoid = obj:FindFirstChildOfClass("Humanoid")
        if obj:IsA("Model") and humanoid and humanoid.Health > 0 then
            -- เช็คชื่อมอนสเตอร์จากใน List
            local isTarget = false
            for _, name in ipairs(FarmableMonsters) do
                if obj.Name:lower():find(name:lower()) then
                    isTarget = true
                    break
                end
            end
            
            if isTarget then
                local targetHRP = obj.PrimaryPart or obj:FindFirstChild("HumanoidRootPart")
                if targetHRP then
                    local dist = (hrp.Position - targetHRP.Position).Magnitude
                    if dist < shortestDist then
                        shortestDist = dist
                        closest = targetHRP
                    end
                end
            end
        end
    end
    return closest
end

-- [3] UI Settings (Wind UI)
local WindUI = loadstring(game:HttpGet("https://tree-hub.vercel.app/api/UI/WindUI"))()
local Window = WindUI:CreateWindow({
    Title = "Gemini Warp Farm",
    Icon = "rbxassetid://10734923210",
    Author = "Gemini AI",
    Folder = "WarpFarmConfig"
})

local MainTab = Window:Tab({ Title = "Main", Icon = "rbxassetid://10734923210" })

MainTab:Toggle({
    Title = "Auto Farm (Warp Mode)",
    Desc = "วาร์ปไปเหนือหัวมอนสเตอร์อัตโนมัติ",
    Value = false,
    Callback = function(state)
        getgenv().AutoFarmEnabled = state
    end
})

MainTab:Slider({
    Title = "Warp Height",
    Desc = "ระยะความสูงเหนือมอนเตอร์ (ตอนนี้คือ 5)",
    Min = 0,
    Max = 20,
    Step = 1,
    Value = 5,
    Callback = function(v)
        getgenv().FarmHeight = v
    end
})

MainTab:Slider({
    Title = "Warp Speed (Delay)",
    Desc = "ยิ่งน้อยยิ่งวาร์ปไว",
    Min = 0.1,
    Max = 1.5,
    Step = 0.1,
    Value = 0.3,
    Callback = function(v)
        getgenv().WarpDelay = v
    end
})

local MiscTab = Window:Tab({ Title = "Misc", Icon = "rbxassetid://10734923210" })

MiscTab:Button({
    Title = "Rejoin Game",
    Callback = function()
        TeleportService:Teleport(game.PlaceId, player)
    end
})

-- [4] Main Loop System (วางไว้ด้านล่างสุด)
task.spawn(function()
    while task.wait() do
        if getgenv().AutoFarmEnabled then
            local target = getClosestMonster()
            local character = player.Character
            local hrp = character and character:FindFirstChild("HumanoidRootPart")
            
            if target and hrp then
                -- วาร์ป
                hrp.CFrame = CFrame.new(target.Position + Vector3.new(0, getgenv().FarmHeight, 0))
                -- หน่วงเวลาตามที่ตั้งค่าไว้ใน Slider
                task.wait(getgenv().WarpDelay)
            end
        end
    end
end)

WindUI:Notify({
    Title = "Ready!",
    Content = "สคริปต์เรียงลำดับและพร้อมใช้งานแล้ว",
    Time = 5
})
