-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "Solo Hunters Felon HUB (Premium)",
    Icon = "user",
    Author = "https://discord.gg/AXTKtmUvyf",
    OpenButton = {
        Title = "Felon HUB",
        Icon = "monitor",
        Enabled = true,
        Draggable = true,
    }
})

local Main = Window:Tab({
    Title = "Main",
    Icon = "home", -- เปลี่ยน Icon เป็นชื่อที่ Library รองรับ
})

local VirtualUser = game:GetService("VirtualUser")
_G.AutoClick = false -- ตั้งต้นให้เป็น false ไว้ก่อน

-- ฟังก์ชันสำหรับคลิก
local function DoClick()
    task.spawn(function()
        while _G.AutoClick do
            pcall(function()
                VirtualUser:CaptureController()
                VirtualUser:ClickButton1(Vector2.new(0, 0))
            end)
            task.wait(0.1) -- ความเร็วในการกด
        end
    end)
end

Main:Toggle({
    Title = "Auto Attack",
    Desc = "Auto hit (Sword)",
    Value = false,
    Callback = function(v)
        _G.AutoClick = v -- กำหนดค่าตามปุ่ม Toggle (true หรือ false)
        if v then
            DoClick() -- ถ้าเปิด ให้เริ่มทำงาน
            print("Auto Clicker: ON")
        else
            print("Auto Clicker: OFF")
        end
    end
})
Main:Button({
    Title = "Auto Quest",
    Desc = "Auto Task",
    Callback = function()
        local questName = "Subway" -- เปลี่ยนชื่อเควสตรงนี้จุดเดียวพอ

        local rs = game:GetService("ReplicatedStorage")
        local questRF = rs:WaitForChild("RemoteServices")
            :WaitForChild("QuestsV2Service")
            :WaitForChild("RF")
            :WaitForChild("RequestQuest")

        -- กันกดรัว
        if _G.RequestingQuest then return end
        _G.RequestingQuest = true

        -- ยิงแบบกันพัง
        local success, result = pcall(function()
            return questRF:InvokeServer(questName)
        end)

        if success then
            print("รับเควสสำเร็จ:", result)
        else
            warn("รับเควสไม่สำเร็จ:", result)
        end

        task.wait(1)
        _G.RequestingQuest = false
    end
})
--// ===== SETUP ครั้งเดียวพอ =====
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local RemoteServices = ReplicatedStorage:WaitForChild("RemoteServices")
local DungeonService = RemoteServices:WaitForChild("DungeonService")
local RF = DungeonService:WaitForChild("RF")
local StartDungeon = RF:WaitForChild("StartDungeon") -- RemoteFunction


-- ฟังก์ชันเริ่มดันเจี้ยน
local function startDungeon()
    local success, result = pcall(function()
        return StartDungeon:InvokeServer()
    end)

    if success then
        print("Dungeon Started:", result)
    else
        warn("Dungeon Error:", result)
    end
end


--// ===== UI BUTTON =====
Main:Button({
    Title = "Start Dungeon",
    Desc = "Start the dungeon once",
    Callback = function()
        startDungeon()
    end
})
-- // Auto Farm ลอยเหนือมอนสเตอร์ + ติดตามตัวใกล้สุด
-- // ใช้ BodyPosition เพื่อเคลื่อนที่แบบนุ่มนวล ไม่ใช่ CFrame teleport

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- ตัวแปรควบคุม (global เพื่อให้ toggle เข้าถึงได้)
getgenv().AutoFarmEnabled = false
getgenv().FarmHeight = 10          -- ความสูงเหนือหัวมอน
getgenv().MaxFarmDistance = 500    -- ระยะสูงสุดที่มองหามอน

-- ตัวแปรสำหรับ BodyPosition
local bodyPos = nil

-- ฟังก์ชันสร้าง BodyPosition เมื่อต้องการ
local function setupBodyMover(hrp)
    if bodyPos then return end
    
    bodyPos = Instance.new("BodyPosition")
    bodyPos.MaxForce = Vector3.new(40000, 40000, 40000)
    bodyPos.P = 15000
    bodyPos.D = 1000
    bodyPos.Parent = hrp
end

-- ตรวจสอบว่าตัวเป็นมอนสเตอร์ที่ใช้งานได้จริงหรือไม่
local function isValidMonster(model)
    if not model or not model:IsA("Model") then return false end
    
    local humanoid = model:FindFirstChildWhichIsA("Humanoid")
    if not humanoid then return false end
    if humanoid.Health <= 0 then return false end
    
    -- ไม่ใช่ตัวเรา และไม่ใช่ผู้เล่นอื่น
    if model == player.Character then return false end
    if Players:GetPlayerFromCharacter(model) then return false end
    
    return true
end

-- หามอนสเตอร์ที่ใกล้ที่สุด
local function getClosestMonster()
    local character = player.Character
    if not character then return nil end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end
    
    local closest = nil
    local shortestDist = getgenv().MaxFarmDistance

    -- วนดูเฉพาะลูกใน Workspace (เร็วกว่า GetDescendants เยอะ)
    for _, obj in ipairs(workspace:GetChildren()) do
        if isValidMonster(obj) then
            local targetHRP = obj:FindFirstChild("HumanoidRootPart") 
                             or obj:FindFirstChild("Torso") 
                             or obj:FindFirstChild("UpperTorso")
                             or obj:FindFirstChild("LowerTorso")
            
            if targetHRP then
                local distance = (hrp.Position - targetHRP.Position).Magnitude
                if distance < shortestDist then
                    shortestDist = distance
                    closest = targetHRP
                end
            end
        end
    end
    
    return closest
end

-- จัดการเมื่อตัวละครเกิดใหม่ (respawn)
player.CharacterAdded:Connect(function(newChar)
    task.wait(0.5) -- รอให้ตัวละครโหลดเสร็จ
    
    -- ล้าง BodyPosition เก่า
    if bodyPos then
        bodyPos:Destroy()
        bodyPos = nil
    end
    
    -- ถ้ากำลังเปิด Auto Farm ให้ตั้งค่าใหม่ทันที
    if getgenv().AutoFarmEnabled then
        local newHRP = newChar:WaitForChild("HumanoidRootPart", 5)
        if newHRP then
            setupBodyMover(newHRP)
        end
    end
end)

-- ระบบหลัก (ใช้ Heartbeat เพราะเบากว่า RenderStepped)
RunService.Heartbeat:Connect(function()
    if not getgenv().AutoFarmEnabled then
        -- เมื่อปิด → คืนตำแหน่งให้ปกติ
        if bodyPos then
            local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                bodyPos.Position = hrp.Position
            end
        end
        return
    end

    local character = player.Character
    if not character then return end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local target = getClosestMonster()
    
    if target then
        -- สร้าง BodyPosition ถ้ายังไม่มี
        if not bodyPos or bodyPos.Parent ~= hrp then
            setupBodyMover(hrp)
        end
        
        -- ตำแหน่งเป้าหมาย = เหนือหัวมอน
        local targetPos = target.Position + Vector3.new(0, getgenv().FarmHeight, 0)
        bodyPos.Position = targetPos
    else
        -- ไม่มีมอน → อยู่กับที่
        if bodyPos then
            bodyPos.Position = hrp.Position
        end
    end
end)

-- =================================================
--                ส่วน UI (ตัวอย่าง)
-- =================================================
-- เปลี่ยนส่วนนี้ให้ตรงกับ UI Library ที่คุณใช้จริง

-- ตัวอย่างสมมติใช้ Fluxus / Orca / Shadow UI style
-- ถ้าใช้ Kavo, Rayfield, Linoria ฯลฯ ให้ปรับตาม syntax ของแต่ละตัว

Main:Toggle({
    Title = "Auto Farm",
    Desc = "ลอยเหนือมอนสเตอร์อัตโนมัติ",
    Value = false,
    Callback = function(value)
        getgenv().AutoFarmEnabled = value
        
        if value then
            print("[AutoFarm] เปิดแล้ว")
            -- ถ้าต้องการแจ้งในเกม
            -- game:GetService("StarterGui"):SetCore("SendNotification", {
            --     Title = "Auto Farm", Text = "เปิดแล้ว", Duration = 3
            -- })
        else
            print("[AutoFarm] ปิดแล้ว")
            -- รีเซ็ตเมื่อปิด
            if bodyPos then
                bodyPos:Destroy()
                bodyPos = nil
            end
        end
    end
})

-- เพิ่ม Toggle ปรับความสูง (optional)
Main:Slider({
    Title = "ความสูงเหนือมอน",
    Min = 5,
    Max = 25,
    Default = 10,
    Callback = function(value)
        getgenv().FarmHeight = value
    end
})

print("Auto Farm Script Loaded!")