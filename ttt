-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "Solo Hunters Felon HUB (Premium11345)",
    Icon = "user",
    Author = "https://discord.gg/AXTKtmUvyf",
    OpenButton = {
        Title = "Felon HUB",
        Icon = "monitor",
        Enabled = true,
        Draggable = true,
    }
})

local Main = Window:Tab({
    Title = "Main",
    Icon = "star",
})

Main:Section({ Title = " Player Settings " })
Main:Toggle({
    Title = "Damage Aura",
    Desc = "Auto damage Aura(sword) - Range 500",
    Value = false, -- สถานะเริ่มต้น
    Callback = function(v)
        _G.AutoClick = v 
        
        if v then
            print("Auto Attack: ON")
            -- ใช้ task.spawn เพื่อให้ลูปทำงานแยกจาก UI (ไม่งั้น UI จะค้าง)
            task.spawn(function()
                while _G.AutoClick do
                    local targetList = {}
                    local player = game.Players.LocalPlayer
                    local char = player.Character
                    
                    -- ตรวจสอบตำแหน่งของเรา
                    if char and char:FindFirstChild("HumanoidRootPart") then
                        local myPos = char.HumanoidRootPart.Position
                        local mobsFolder = workspace:FindFirstChild("Mobs") -- เช็คชื่อโฟลเดอร์ให้ตรงกับในเกม
                        
                        if mobsFolder then
                            for _, mob in pairs(mobsFolder:GetChildren()) do
                                local hum = mob:FindFirstChild("Humanoid")
                                local hrp = mob:FindFirstChild("HumanoidRootPart")
                                
                                -- เช็คว่ามอนสเตอร์ยังไม่ตายและอยู่ในระยะ 500
                                if hum and hrp and hum.Health > 0 then
                                    local dist = (myPos - hrp.Position).Magnitude
                                    if dist <= 500 then
                                        table.insert(targetList, mob)
                                    end
                                end
                            end
                        end
                        
                        -- ถ้าเจอเป้าหมาย ส่ง Remote ทันที
                        if #targetList > 0 then
                            pcall(function()
                                -- Remote ที่คุณหามา
                                game:GetService("ReplicatedStorage").RemoteServices.CombatService.RF.UseWeapon:InvokeServer(0, targetList, 1)
                            end)
                        end
                    end
                    task.wait(0.1) -- ปรับความเร็วตรงนี้ (0.1 คือกำลังดี)
                end
            end)
        else
            print("Auto Attack: OFF")
        end
    end
})


Main:Button({
    Title = "Auto Quest (Hunter Tin)",
    Desc = "Auto Task",
    Callback = function()
        local questName = "Subway" -- เปลี่ยนชื่อเควสตรงนี้จุดเดียวพอ

        local rs = game:GetService("ReplicatedStorage")
        local questRF = rs:WaitForChild("RemoteServices")
            :WaitForChild("QuestsV2Service")
            :WaitForChild("RF")
            :WaitForChild("RequestQuest")

        -- กันกดรัว
        if _G.RequestingQuest then return end
        _G.RequestingQuest = true

        -- ยิงแบบกันพัง
        local success, result = pcall(function()
            return questRF:InvokeServer(questName)
        end)

        if success then
            print("รับเควสสำเร็จ:", result)
        else
            warn("รับเควสไม่สำเร็จ:", result)
        end

        task.wait(1)
        _G.RequestingQuest = false
    end
})
--// ===== SETUP ครั้งเดียวพอ =====
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local RemoteServices = ReplicatedStorage:WaitForChild("RemoteServices")
local DungeonService = RemoteServices:WaitForChild("DungeonService")
local RF = DungeonService:WaitForChild("RF")
local StartDungeon = RF:WaitForChild("StartDungeon") -- RemoteFunction


-- ฟังก์ชันเริ่มดันเจี้ยน
local function startDungeon()
    local success, result = pcall(function()
        return StartDungeon:InvokeServer()
    end)

    if success then
        print("Dungeon Started:", result)
    else
        warn("Dungeon Error:", result)
    end
end

Main:Section({ Title = "Dungeon Setting" })
--// ===== UI BUTTON =====
Main:Button({
    Title = "Start Dungeon",
    Desc = "Start the dungeon once",
    Callback = function()
        startDungeon()
    end
})
Main:Toggle({
    Title = "Auto Farm (Ultra Fix)",
    Desc = "Fast Warp + Anti-Lag + Auto Target",
    Value = false,
    Callback = function(v)
        _G.AutoFarm = v 

        local player = game.Players.LocalPlayer
        local runService = game:GetService("RunService")
        local hb -- ตัวเก็บ Connection

        -- ฟังก์ชันทำความสะอาดเมื่อปิด
        local function cleanup()
            if hb then hb:Disconnect() end
            local char = player.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                -- ลบแรงส่งและคืนค่าตัวละคร
                for _, obj in pairs(char.HumanoidRootPart:GetChildren()) do
                    if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
                end
                char.HumanoidRootPart.CFrame = CFrame.new(char.HumanoidRootPart.Position)
            end
        end

        if not v then 
            cleanup()
            return 
        end

        -- สร้างแรงยก (ป้องกันตัวละครร่วงหรือดีด)
        local function applyPhysics(hrp)
            local bv = hrp:FindFirstChild("FarmBV") or Instance.new("BodyVelocity", hrp)
            bv.Name = "FarmBV"
            bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bv.Velocity = Vector3.new(0, 0, 0)
        end

        -- เริ่มทำงาน
        hb = runService.Heartbeat:Connect(function()
            if not _G.AutoFarm then cleanup() return end

            local char = player.Character
            local hrp = char and char:FindFirstChild("HumanoidRootPart")
            if not hrp then return end

            applyPhysics(hrp)

            -- ค้นหาเป้าหมาย (เช็คทั้ง Workspace)
            local target = nil
            local dist = 1000 -- ระยะ

            for _, m in pairs(game.Workspace:GetDescendants()) do
                -- เงื่อนไข: เป็น Model + มี Humanoid + เลือด > 0 + ไม่ใช่ตัวเรา + ไม่ใช่ผู้เล่นคนอื่น
                if m:IsA("Humanoid") and m.Parent:IsA("Model") and m.Health > 0 then
                    local mHRP = m.Parent:FindFirstChild("HumanoidRootPart")
                    if mHRP and m.Parent ~= char and not game.Players:GetPlayerFromCharacter(m.Parent) then
                        local magnitude = (hrp.Position - mHRP.Position).Magnitude
                        if magnitude < dist then
                            target = mHRP
                            dist = magnitude
                        end
                    end
                end
            end

            if target then
                -- วาร์ปไปเหนือหัว + ท่านอน (Horizontal)
                hrp.CFrame = CFrame.new(target.Position + Vector3.new(0, 10, 0)) 
                           * CFrame.Angles(math.rad(-90), 0, 0)
            end
        end)
    end
})
-- [[ CONFIGURATION ]]
_G.DamageAura = false
local AuraRange = 500 -- ระยะที่คุณต้องการ
local AttackSpeed = 0.1 -- ความเร็ว (0.1 - 0.2 กำลังดีสำหรับ InvokeServer)

-- [[ CORE FUNCTION ]]
local function getAuraTargets()
    local targets = {}
    local player = game.Players.LocalPlayer
    local char = player.Character
    
    -- ตรวจสอบว่ามีตัวละครและจุดยืน (RootPart)
    if not char or not char:FindFirstChild("HumanoidRootPart") then return targets end
    
    local mobsFolder = workspace:FindFirstChild("Mobs")
    if mobsFolder then
        for _, mob in pairs(mobsFolder:GetChildren()) do
            local hum = mob:FindFirstChild("Humanoid")
            local hrp = mob:FindFirstChild("HumanoidRootPart")
            
            if hum and hrp and hum.Health > 0 then
                -- คำนวณระยะห่างระหว่างเรากับมอนสเตอร์
                local mag = (char.HumanoidRootPart.Position - hrp.Position).Magnitude
                if mag <= AuraRange then
                    table.insert(targets, mob)
                end
            end
        end
    end
    return targets
end

-- [[ UI BUTTON INTEGRATION ]]
Main:Button({
    Title = "Damage Aura (500)",
    Desc = "โจมตีศัตรูรอบตัวอัตโนมัติ",
    Callback = function()
        -- สลับสถานะ เปิด/ปิด
        _G.DamageAura = not _G.DamageAura
        
        if _G.DamageAura then
            print("Damage Aura: ACTIVATED")
            
            -- เริ่มลูปการโจมตี
            task.spawn(function()
                while _G.DamageAura do
                    local targetList = getAuraTargets()
                    
                    if #targetList > 0 then
                        -- ส่ง Remote ตามที่คุณหามา
                        local args = {
                            [1] = 0,
                            [2] = targetList, -- ใส่ตารางมอนสเตอร์ทั้งหมด
                            [3] = 1
                        }
                        
                        -- ใช้ pcall เพื่อป้องกัน Script ค้างถ้ามอนสเตอร์หายไปกระทันหัน
                        pcall(function()
                            game:GetService("ReplicatedStorage").RemoteServices.CombatService.RF.UseWeapon:InvokeServer(unpack(args))
                        end)
                    end
                    task.wait(AttackSpeed)
                end
                print("Damage Aura: STOPPED")
            end)
        else
            -- สั่งหยุดการทำงาน
            _G.DamageAura = false
        end
    end
})

local TP = Window:Tab({
    Title = "TP ",
    Icon = "locate"          -- แก้ตรงนี้ (เลือกชื่อที่ library มีจริง)
})

-- ฟังก์ชันช่วยเหลือ (ทำให้โค้ดสั้นลงและเหมือนกันหมด)
local function teleportTo(pos)
    local player = game.Players.LocalPlayer
    local char = player.Character
    
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(pos + Vector3.new(0, 3, 0)) -- บวก 3 ทุกครั้ง
        print("Teleported to " .. tostring(pos))
    else
        warn("ไม่พบตัวละครหรือ HumanoidRootPart")
    end
end
TP:Section({ Title = " Summon Teleport " })
TP:Button({
    Title = "Telepot to Summon Powers",
    Desc = "วาปไปที่สุ่มพลัง",
    Callback = function()
        teleportTo(Vector3.new(61.74, -9.45, -113.31))
    end
})
TP:Section({ Title = " Shop and Sell Teleport " })
TP:Button({
    Title = "Telepot to Sell loot here",
    Desc = "วาปไปที่ขายไอเทม",
    Callback = function()
        teleportTo(Vector3.new(-24.34, -7.45, -72.88))
    end
})

TP:Button({
    Title = "Telepot to merchant (shop item)",
    Desc = "วาปไปที่ซื้อไอเทม",
    Callback = function()
        teleportTo(Vector3.new(-45.38, -9.45, 15.51))
    end
})

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

getgenv().SelectedPlayer = nil

-- ===== PLAYER LIST =====
local PlayerList = {}

local function RefreshPlayers()
    table.clear(PlayerList)
    for _,p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            table.insert(PlayerList, p.Name)
        end
    end
end

RefreshPlayers()
Players.PlayerAdded:Connect(RefreshPlayers)
Players.PlayerRemoving:Connect(RefreshPlayers)

-- ===== SPECTATE =====
local function Spectate(plr)
    if plr and plr.Character and plr.Character:FindFirstChild("Humanoid") then
        Camera.CameraSubject = plr.Character.Humanoid
    end
end

local function UnSpectate()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        Camera.CameraSubject = LocalPlayer.Character.Humanoid
    end
end

-- ===== TP INSTANT =====
local function TPToPlayer(plr)
    if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame =
            plr.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -3)
    end
end

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Remote (เตรียมไว้ครั้งเดียว ไม่ต้องหาใหม่ทุกกด)
local RequestQuest = ReplicatedStorage
    :WaitForChild("RemoteServices")
    :WaitForChild("QuestsV2Service")
    :WaitForChild("RF")
    :WaitForChild("RequestQuest")

-- Tab
local Quest = Window:Tab({
    Title = "Quest",
    Icon = "scroll",
})

-- กันกดรัว
local debounce = false

-- Button
Quest:Button({
    Title = "Get Quest (Rubble Doug)",
    Desc = "รับเควสเลเวล 20",
    Callback = function()

        if debounce then return end
        debounce = true

        local success, err = pcall(function()
            RequestQuest:InvokeServer("Caves")
        end)

        if success then
            print("รับเควสสำเร็จ")
        else
            warn("ผิดพลาด: " .. tostring(err))
        end

        task.wait(2) -- หน่วงกันสแปม
        debounce = false
    end
})