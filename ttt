-- Load WindUI
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

-- Window
local Window = WindUI:CreateWindow({
    Title = "Solo Hunters Felon HUB (Premium)",
    Icon = "user",
    Author = "https://discord.gg/AXTKtmUvyf",
    OpenButton = {
        Title = "Felon HUB",
        Icon = "monitor",
        Enabled = true,
        Draggable = true,
    }
})

local Main = Window:Tab({
    Title = "Main",
    Icon = "star",
})

local VirtualUser = game:GetService("VirtualUser")
local Camera = workspace.CurrentCamera
_G.AutoClick = false

-- ฟังก์ชันสำหรับคลิก
local function DoClick()
    task.spawn(function()
        while _G.AutoClick do
            pcall(function()
                -- คำนวณหาตำแหน่งมุมขวาบน (ลบระยะขอบออกเล็กน้อยเพื่อให้โดนปุ่มพอดี)
                local screenWidth = Camera.ViewportSize.X
                local rightTop = Vector2.new(screenWidth - 50, 50) 
                
                VirtualUser:CaptureController()
                VirtualUser:ClickButton1(rightTop)
            end)
            task.wait(0.1) -- ปรับความเร็วตรงนี้ (0.1 คือ 10 ครั้งต่อวินาที)
        end
    end)
end

Main:Section({ Title = " Player Settings " })
Main:Toggle({
    Title = "Auto Attack",
    Desc = "Auto hit (sword)",
    Value = false,
    Callback = function(v)
        _G.AutoClick = v 
        if v then
            DoClick()
            print("Auto Clicker (Top Right): ON")
        else
            print("Auto Clicker: OFF")
        end
    end
})

Main:Button({
    Title = "Auto Quest (Hunter Tin)",
    Desc = "Auto Task",
    Callback = function()
        local questName = "Subway" -- เปลี่ยนชื่อเควสตรงนี้จุดเดียวพอ

        local rs = game:GetService("ReplicatedStorage")
        local questRF = rs:WaitForChild("RemoteServices")
            :WaitForChild("QuestsV2Service")
            :WaitForChild("RF")
            :WaitForChild("RequestQuest")

        -- กันกดรัว
        if _G.RequestingQuest then return end
        _G.RequestingQuest = true

        -- ยิงแบบกันพัง
        local success, result = pcall(function()
            return questRF:InvokeServer(questName)
        end)

        if success then
            print("รับเควสสำเร็จ:", result)
        else
            warn("รับเควสไม่สำเร็จ:", result)
        end

        task.wait(1)
        _G.RequestingQuest = false
    end
})
--// ===== SETUP ครั้งเดียวพอ =====
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local RemoteServices = ReplicatedStorage:WaitForChild("RemoteServices")
local DungeonService = RemoteServices:WaitForChild("DungeonService")
local RF = DungeonService:WaitForChild("RF")
local StartDungeon = RF:WaitForChild("StartDungeon") -- RemoteFunction


-- ฟังก์ชันเริ่มดันเจี้ยน
local function startDungeon()
    local success, result = pcall(function()
        return StartDungeon:InvokeServer()
    end)

    if success then
        print("Dungeon Started:", result)
    else
        warn("Dungeon Error:", result)
    end
end

Main:Section({ Title = "Dungeon Setting" })
--// ===== UI BUTTON =====
Main:Button({
    Title = "Start Dungeon",
    Desc = "Start the dungeon once",
    Callback = function()
        startDungeon()
    end
})
Main:Toggle({
    Title = "Auto Farm",
    Desc = "Auto Farm mob",
    Value = false,
    Callback = function(v)
        _G.AutoFarm = v -- กำหนดสถานะเปิด/ปิดผ่าน Global Variable

        local player = game.Players.LocalPlayer
        local runService = game:GetService("RunService")

        -- การตั้งค่า
        local MAX_DISTANCE = 500
        local HEIGHT_ABOVE = -7 

        -- สร้าง BodyVelocity เพื่อความนิ่ง
        local bv = Instance.new("BodyVelocity")
        bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
        bv.Velocity = Vector3.new(0, 0, 0)

        -- ฟังก์ชันหามอนสเตอร์
        local function getClosestMonster()
            local closestTarget = nil
            local shortestDistance = MAX_DISTANCE
            local myHRP = player.Character and player.Character:FindFirstChild("HumanoidRootPart")

            if not myHRP then return nil end

            for _, obj in pairs(game.Workspace:GetDescendants()) do
                if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj:FindFirstChild("HumanoidRootPart") then
                    if obj ~= player.Character and not game.Players:GetPlayerFromCharacter(obj) then
                        local distance = (myHRP.Position - obj.HumanoidRootPart.Position).Magnitude
                        if distance <= shortestDistance then
                            closestTarget = obj.HumanoidRootPart
                            shortestDistance = distance
                        end
                    end
                end
            end
            return closestTarget
        end

        -- ลูปการทำงาน (จะทำงานเฉพาะตอนที่ _G.AutoFarm เป็น true)
        task.spawn(function()
            while _G.AutoFarm do
                local target = getClosestMonster()
                local character = player.Character
                local myHRP = character and character:FindFirstChild("HumanoidRootPart")

                if target and myHRP then
                    -- ล็อคความเร็วให้นิ่ง
                    if bv.Parent ~= myHRP then
                        bv.Parent = myHRP
                    end
                    -- วาร์ปไปเหนือหัวเป้าหมาย
                    myHRP.CFrame = CFrame.new(target.Position + Vector3.new(0, HEIGHT_ABOVE, 0))
                else
                    bv.Parent = nil
                end
                task.wait() -- ป้องกันเกมค้าง
            end
            
            -- เมื่อปิด Toggle ให้ล้างค่า
            if bv then bv.Parent = nil end
        end)
    end
})